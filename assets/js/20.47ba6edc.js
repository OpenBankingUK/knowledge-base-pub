(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{207:function(e,t,i){"use strict";i.r(t);var o=i(3),s=Object(o.a)({},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("h2",{attrs:{id:"fapi"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#fapi"}},[e._v("#")]),e._v(" FAPI")]),e._v(" "),i("h3",{attrs:{id:"is-it-mandatory-to-include-the-scope-claim-when-calling-the-token-end-point-as-part-of-an-authorization-code-grant"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#is-it-mandatory-to-include-the-scope-claim-when-calling-the-token-end-point-as-part-of-an-authorization-code-grant"}},[e._v("#")]),e._v(" "),i("strong",[e._v("Is it mandatory to include the "),i("code",[e._v("scope")]),e._v(" claim when calling the token end-point as part of an authorization_code grant?")])]),e._v(" "),i("p",[e._v("No, it is not mandatory for the client to include the 'scope' in the token request.")]),e._v(" "),i("h3",{attrs:{id:"as-an-aspsp-which-security-certification-should-i-request-from-open-id-if-i-see-multiple-types-for-fapi"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#as-an-aspsp-which-security-certification-should-i-request-from-open-id-if-i-see-multiple-types-for-fapi"}},[e._v("#")]),e._v(" "),i("strong",[e._v("As an ASPSP, which security certification should I request from Open ID if I see multiple types for FAPI?")])]),e._v(" "),i("p",[e._v("ASPSP must select FAPI-Advanced-Final- Authorization server test.")]),e._v(" "),i("h3",{attrs:{id:"which-scope-element-should-the-tpps-use-when-requesting-token-grant-type-authorization-code"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#which-scope-element-should-the-tpps-use-when-requesting-token-grant-type-authorization-code"}},[e._v("#")]),e._v(" "),i("strong",[e._v("Which scope element should the TPPs use when requesting token (grant type=authorization_code)?")])]),e._v(" "),i("p",[e._v("TPPs should follow FAPI guidelines for the "),i("code",[e._v("scope")]),e._v(" element.")]),e._v(" "),i("h3",{attrs:{id:"what-should-the-aspsp-do-if-the-tpp-omits-the-scope-parameter-when-requesting-authorization"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#what-should-the-aspsp-do-if-the-tpp-omits-the-scope-parameter-when-requesting-authorization"}},[e._v("#")]),e._v(" "),i("strong",[e._v("What should the ASPSP do if the TPP omits the scope parameter when requesting authorization?")])]),e._v(" "),i("p",[e._v("The authorization server must either process the request using a pre-defined default value or fail the request indicating an invalid scope.")]),e._v(" "),i("h3",{attrs:{id:"is-it-compliant-for-a-psu-to-be-redirected-within-a-redirect-in-a-redirect-hybrid-grant"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#is-it-compliant-for-a-psu-to-be-redirected-within-a-redirect-in-a-redirect-hybrid-grant"}},[e._v("#")]),e._v(" "),i("strong",[e._v("Is it compliant for a PSU to be redirected within a redirect in a redirect/hybrid grant?")])]),e._v(" "),i("p",[e._v("For the journey to be a “compliant” OIDC/OAuth2 journey, there are a number of boxes to tick:")]),e._v(" "),i("p",[e._v("The TPP constructs the authorization URL and issues it to the PSU’s browser. The URL should contain query parameters and request objects that are OIDC compliant. The URL should be the authorization_server in the ASPSP’s .well-known. The redirect_uri parameter should be the TPP’s registered URI.")]),e._v(" "),i("p",[e._v("Once the PSU’s browser follows the redirect, the flow can be pretty much whatever the ASPSP wants to implement. The CEGs provide some standards on what those journeys should look like, but no technical constraints on redirects etc that take place.")]),e._v(" "),i("p",[e._v("Finally, that journey MUST end with the PSU browser receiving a 30x Redirect response. The redirect must be to the redirect_uri in the query parameter in #1 above. This URL must have OIDC/OAuth2 format query or hashbang parameters (e.g. code, error, error_description, nonce(?) etc")]),e._v(" "),i("p",[e._v("Practically, some browsers will cause issues with a TOO_MANY_REDIRECTS error - but the standard is silent on that. It is likely that old / non-evergreen browsers may cause some issues.")]),e._v(" "),i("h3",{attrs:{id:"can-refresh-token-be-issued-without-an-hok-mechanism-to-avoid-impacts-on-member-and-would-it-be-in-compliance-with-fapi"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#can-refresh-token-be-issued-without-an-hok-mechanism-to-avoid-impacts-on-member-and-would-it-be-in-compliance-with-fapi"}},[e._v("#")]),e._v(" "),i("strong",[e._v("Can refresh token be issued without an HoK mechanism to avoid impacts on member and would it be in compliance with FAPI?")])]),e._v(" "),i("h3",{attrs:{id:"if-a-refresh-token-is-issued-with-mtls-hok-would-it-force-the-psu-to-re-authenticate-would-this-be-an-acceptable-user-journey"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#if-a-refresh-token-is-issued-with-mtls-hok-would-it-force-the-psu-to-re-authenticate-would-this-be-an-acceptable-user-journey"}},[e._v("#")]),e._v(" "),i("strong",[e._v("If a refresh token is issued with MTLS HoK, would it force the PSU to re-authenticate? Would this be an acceptable user Journey?")])]),e._v(" "),i("p",[e._v("When using a refresh token, there should be no expectation on the PSU to re-authenticate each time they access token is renewed. TPPs are expected to use the “refreshing AISP access” journey in the CEGs.")]),e._v(" "),i("p",[e._v("The certificate binding mechanism with RFC-8705 does allow this to be implemented correctly.")]),e._v(" "),i("p",[e._v("The method for certificate binding is defined in https://tools.ietf.org/html/rfc8705#section-7.1. (Note that we do not have public clients and Section 4 of RF-8705 will not be applicable)")]),e._v(" "),i("p",[e._v("Effectively, a refresh token is not certificate bound directly but bound indirectly through the client. The client, in turn, needs to authenticate with the token endpoint using a strong method of authentication ("),i("code",[e._v("tls_client_auth")]),e._v(" or "),i("code",[e._v("private_key_jwt")]),e._v(").")]),e._v(" "),i("p",[e._v("If using "),i("code",[e._v("private_key_jwt")]),e._v(", the signature is based on a key pair in the client’s JWKS registered with the ASPSP. No certificates are involved. Done.")]),e._v(" "),i("p",[e._v("If using "),i("code",[e._v("tls_client_auth")]),e._v(", the certificate is validated by comparing with tls_client_auth_subject_dn - not the certificate fingerprint. This would allow the TPP to make a call to the token endpoint with the new certs with their current refresh token. The new access token would be bound to the new cert. Done.")]),e._v(" "),i("h3",{attrs:{id:"is-it-acceptable-for-an-aspsp-to-have-multiple-authorization-servers-how-should-these-be-discoverable"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#is-it-acceptable-for-an-aspsp-to-have-multiple-authorization-servers-how-should-these-be-discoverable"}},[e._v("#")]),e._v(" "),i("strong",[e._v("Is it acceptable for an ASPSP to have multiple authorization servers? How should these be discoverable?")])]),e._v(" "),i("p",[e._v("ASPSPs may have multiple AS and RS (e.g. to serve different brands and products). However, for ASPSPs that use the OBL directory, these must be discoverable through the directory.")]),e._v(" "),i("p",[e._v("Furthermore, the use of additional authorization servers should not result in invalid or incorrectly formed OIDC discovery documents.")]),e._v(" "),i("h3",{attrs:{id:"is-there-any-guidance-on-how-long-in-advance-of-being-fapi-complaint-aspsps-should-send-out-notice"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#is-there-any-guidance-on-how-long-in-advance-of-being-fapi-complaint-aspsps-should-send-out-notice"}},[e._v("#")]),e._v(" "),i("strong",[e._v("Is there any guidance on how long in advance of being FAPI complaint ASPSPs should send out notice?")])]),e._v(" "),i("p",[e._v("SCA - RTS, Article 30(4) contemplates that ASPSPs must give TPPs a minimum of three months’ notice of any change to the technical specification of their interface change except for emergency situations.")]),e._v(" "),i("p",[e._v("For more details refer to https://standards.openbanking.org.uk/operational-guidelines/change-and-communication-management/changes-to-an-aspsps-infrastructure-configuration-or-software/latest/.")]),e._v(" "),i("h3",{attrs:{id:"can-the-same-authorization-endpoint-be-used-repeatedly-while-it-is-not-authorized-by-psu-or-is-there-any-time-limitation-to-use-the-endpoint"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#can-the-same-authorization-endpoint-be-used-repeatedly-while-it-is-not-authorized-by-psu-or-is-there-any-time-limitation-to-use-the-endpoint"}},[e._v("#")]),e._v(" "),i("strong",[e._v("Can the same Authorization endpoint be used repeatedly while it is not authorized by PSU or is there any time limitation to use the endpoint?")])]),e._v(" "),i("p",[e._v("There are no specific constraints in the OIDC and FAPI standards around the expected behaviour of hitting an authorization URL multiple times.")]),e._v(" "),i("p",[e._v("FAPI requires that the call has a signed request. The request object must have an "),i("code",[e._v("exp")]),e._v(" and "),i("code",[e._v("nbf")]),e._v(" claim as stipulated here. This would limit the validity period for an authorization URL.")]),e._v(" "),i("h3",{attrs:{id:"as-a-tpp-when-going-through-an-authorization-code-grant-is-the-request-object-required-even-if-i-am-not-using-a-hybrid-flow"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#as-a-tpp-when-going-through-an-authorization-code-grant-is-the-request-object-required-even-if-i-am-not-using-a-hybrid-flow"}},[e._v("#")]),e._v(" "),i("strong",[e._v("As a TPP, when going through an authorization code grant, is the request object required even if I am not using a hybrid flow?")])]),e._v(" "),i("p",[e._v("ASPSPs that use the OBL directory should register each authorization server on the OBL directory with its corresponding discovery end-point.")]),e._v(" "),i("h4",{attrs:{id:"oidc-discovery"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#oidc-discovery"}},[e._v("#")]),e._v(" OIDC Discovery")]),e._v(" "),i("p",[e._v("The OpenID Connect Discovery\n"),i("a",{staticClass:"external-link",attrs:{href:"https://openid.net/specs/openid-connect-discovery-1_0.html",rel:"nofollow"}},[e._v("RFC")]),e._v("\nis the specification that defines the structure and content of the OIDC .well-known end-point.")]),e._v(" "),i("p",[e._v("The document is meant to be “discoverable” by web-finger and by a static URL and should always be available at a URL that can be pre-determined.")]),e._v(" "),i("p",[e._v("For example, the discovery document for the issuer example.com must be available at /.well-known/openid-configuration")]),e._v(" "),i("ol",[i("li",[e._v("GET /.well-known/openid-configuration HTTP/1.1")]),e._v(" "),i("li",[e._v("Host: example.com")])]),e._v(" "),i("p",[e._v("Subsequently, the discovery document that is returned must have example.com specified as the issuer URL.")]),e._v(" "),i("blockquote",[i("p",[e._v("issuer"),i("br"),e._v("\nREQUIRED. URL using the "),i("code",[e._v("https")]),e._v(" scheme with no query or fragment component that the OP asserts as its Issuer Identifier. If Issuer discovery is supported (see "),i("a",{staticClass:"external-link",attrs:{href:"https://openid.net/specs/openid-connect-discovery-1_0.html#IssuerDiscovery",rel:"nofollow"}},[e._v("Section 2")]),e._v("\n), this value MUST be identical to the issuer value returned by WebFinger. This also MUST be identical to the "),i("code",[e._v("iss")]),e._v(" Claim value in ID Tokens issued from this Issuer.")])]),e._v(" "),i("p",[e._v("Additionally, the "),i("code",[e._v("authorization_endpoint")]),e._v(" specified must point to the OP’s authorization server. Note that there is no stipulated relationship between the URL for the authorization_endpoint and the issuer.")]),e._v(" "),i("blockquote",[i("p",[e._v("authorization_endpoint\n"),i("br"),e._v("\nREQUIRED. URL of the OP's OAuth 2.0 Authorization Endpoint "),i("a",{staticClass:"external-link",attrs:{href:"https://openid.net/specs/openid-connect-discovery-1_0.html#OpenID.Core",rel:"nofollow"}},[e._v("[OpenID.Core]")]),e._v(".")])]),e._v(" "),i("p",[e._v("(If the authorization endpoint supports MA-TLS and this end-point is available at a different URI, then RFC 8705 Section 9.2 registers "),i("code",[e._v("mtls_endpoint_aliases.authorization server")]),e._v(" as a field in the discovery document.)")]),e._v(" "),i("h4",{attrs:{id:"issues-noted-in-the-ecosystem"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#issues-noted-in-the-ecosystem"}},[e._v("#")]),e._v(" Issues noted in the ecosystem")]),e._v(" "),i("p",[e._v("The following have been observed by the OIDC FAPI compliance tests in the ecosystem. There are incorrect configurations and are non-compliant with the OIDC discovery specification:")]),e._v(" "),i("ol",[i("li",[i("p",[e._v("Some ASPSPs issue a discovery document where the "),i("code",[e._v("issuer")]),e._v(" field does not match the discovery URL from which the document was retrieved.")])]),e._v(" "),i("li",[i("p",[e._v("Some ASPSPs have one or more authorization servers (e.g. when supporting multiple brands) that are not discoverable through the discovery document.")])])]),e._v(" "),i("p",[e._v("A checklist for correct implementations:")]),e._v(" "),i("ol",[i("li",[i("p",[e._v("ASPSPs must issue a discovery document for their authorization server.")])]),e._v(" "),i("li",[i("p",[e._v("The ASPSP’s issuer URL when suffixed with "),i("code",[e._v("/.well-known/openid-configuration")]),e._v(" must return the discovery document.")])]),e._v(" "),i("li",[i("p",[e._v("The discovery document "),i("code",[e._v("issuer")]),e._v(" field must have the same value as the ASPSP’s issuer URL.")])]),e._v(" "),i("li",[i("p",[e._v("The ASPSP’s authorization server must be listed in the "),i("code",[e._v("authorization_server")]),e._v(" field")])]),e._v(" "),i("li",[i("p",[e._v("The ASPSP’s authorization server field may be optionally listed in the "),i("code",[e._v("mtls_endpoint_aliases.authorization")]),e._v(" server field.")])]),e._v(" "),i("li",[i("p",[e._v("If the ASPSP has multiple authorization servers, each authorization server must be discoverable through a separate discovery document. Each discovery document must meet the criteria above.")])]),e._v(" "),i("li",[i("p",[e._v("ASPSPs that use the OBL directory should register each authorization server on the OBL directory with its corresponding discovery end-point.")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);